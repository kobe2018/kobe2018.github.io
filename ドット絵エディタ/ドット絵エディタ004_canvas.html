<!DOCTYPE HTML>
<html lang="ja">
<head>
<title>ãƒ‰ãƒƒãƒˆçµµä½œæˆã‚¨ãƒ‡ã‚£ã‚¿002</title>
<meta charset="utf-8" />

<link rel="stylesheet" type="text/css" href="css_text_editor_canvas.css"><style></style>
<script >
"use strict";
let [esc_flag,clear_flag]=[true,false];
let code = "ğŸŸ¥";
window.addEventListener("DOMContentLoaded",function(){
    let element = document.querySelector('#ID_canvas01');
    let ID_svg = document.querySelector('#ID_svg');

    const ID_canvas01 = document.getElementById("ID_canvas01");
    if (ID_canvas01.getContext) {
      const context001 = ID_canvas01.getContext("2d");//2æ¬¡å…ƒæç”»
      context001.fillRect(100,0,280,180);//å¡—ã‚Šã¤ã¶ã•ã‚ŒãŸå››è§’å½¢
      //context001.font = "24px GeoMathMono";
      context001.font = '600 24px "GeoMathDotMono",serif';
      context001.fillText(`ğŸŸ¥ğŸŸ§ğŸŸ¨ğŸŸ©ğŸŸ¦ğŸŸªğŸŸ«â¬›â¬œâ–‘â–’â–“`, 24, 48);
      context001.fillText(`ğŸŒ²ğŸŒ³ğŸª¾ğŸªµğŸŒµâ›°ğŸ”ğŸª¨ğŸ§±`, 24, 72);
      context001.fillText(`ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§±`, 24, 96);
      
    }

    document.querySelector('body').style.backgroundColor = 'white';
    
    //keydown(element,element2);
    //keydown(element);
    //keyup(element);
    //function_touch_event();


    document.querySelector('body').addEventListener('keydown', function(eve) {
      if(eve.ctrlKey){
        element.style.pointerEvents = "none";
      } 
    }, false);

    document.querySelector('body').addEventListener('keyup', function(eve) {
      //code=eve.keyCode
      //console.log(code);
      if(!eve.ctrlKey){
        element.style.pointerEvents = "auto";
      } 
    }, false);
    document.querySelector('#ID_canvas01').addEventListener('mouseup', function(eve) {

      //avaScript ã§ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢å†…ã®ã‚«ãƒ¼ã‚½ãƒ«ã®ã‚ã‚‹ä½ç½®ã«æ–‡å­—åˆ—ã‚’æŒ¿å…¥ã™ã‚‹æ–¹æ³•
      //https://qiita.com/noraworld/items/d6334a4f9b07792200a5

      const ID_canvas01 = document.getElementById("ID_canvas01");
    if (ID_canvas01.getContext) {
      const context001 = ID_canvas01.getContext("2d");//2æ¬¡å…ƒæç”»
      context001.fillText(eve.pageX,20, 20);
      context001.fillText(eve.offsetX,20, 40);
      
      context001.fillText(code, eve.offsetX,eve.offsetY);
    }
      let sentence = document.querySelector('#ID_canvas01');
    
      

      //console.log(sentence,sentence.innerHTML.getSelection());ã„
      //console.log(sentence,window.getSelection().getRangeAt(0).getBoundingClientRect());
      

      let len      = [...ID_canvas01.value].length;//utf-8ç”¨è¡¨ç¾â†’1056ã¨å‡ºã‚‹ã€‚
      let pos_start    = ID_canvas01.selectionStart;
      let pos_end      = ID_canvas01.selectionEnd;

      console.log("len ",len);
     // console.log("sentence ",sentence.value,pos_start,pos_end,code);
      console.log("pos_start ",pos_start,pos_end,code);


      let before   = sentence.value.substring(0, pos_start);//substrã¯ä½¿ã‚ãªã„ã€‚
      //console.log("before ",before);
      let insert_word =  code;//insert_word;æŒ¿å…¥ã—ãŸã„æ–‡å­—åˆ—;
      //let after    = sentence.value.substring(pos_start+1, len);
      //let after    = sentence.value.substring(pos_start+1);
      
      //alert( sentence.value.substring(pos_start,pos_end+1));
      console.log("sentence.value.substring(pos_start,pos_end+1) ",sentence.value.substring(pos_start,pos_end+1));
      console.log("sentence.value.substring(pos_start,pos_end+1).split( /[\uD800-\uDBFF][\uDC00-\uDFFF]/g ) ",sentence.value.substring(pos_start,pos_end+2).split( /[\uD800-\uDBFF][\uDC00-\uDFFF]/g ).length);
      
      
      let after ="";
      if(sentence.value.substring(pos_start,pos_end+2).split( /[\uD800-\uDBFF][\uDC00-\uDFFF]/g ).length >=2){
        console.log( "ã‚µãƒ­ã‚²ãƒ¼ãƒˆã§ã™");
        after    = sentence.value.substring(pos_end+2);//ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒ™ã‚¢ã®å ´åˆ
      }else{
        after    = sentence.value.substring(pos_end+1);//é€šå¸¸ã®å ´åˆ
      }
      // console.log("after ",after);
        
      sentence = before + insert_word + after;
      ID_canvas01.value = sentence;

      //console.log(len,pos,word,code);
       
    }, false);


    document.querySelector('#ID_1F7E5').addEventListener('click', function(e) {code="ğŸŸ¥";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F7E7').addEventListener('click', function(e) {code="ğŸŸ§";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F7E8').addEventListener('click', function(e) {code="ğŸŸ¨";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F7E9').addEventListener('click', function(e) {code="ğŸŸ©";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F7E6').addEventListener('click', function(e) {code="ğŸŸ¦";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F7EA').addEventListener('click', function(e) {code="ğŸŸª";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F7EB').addEventListener('click', function(e) {code="ğŸŸ«";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID__2B1B').addEventListener('click', function(e) {code="â¬›";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID__2B1C').addEventListener('click', function(e) {code="â¬œ";document.querySelector('#ID_mode01').innerHTML =code}, false);

    document.querySelector('#ID_1F3FB').addEventListener('click', function(e) {code="ğŸ»";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F3FC').addEventListener('click', function(e) {code="ğŸ¼";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F3FD').addEventListener('click', function(e) {code="ğŸ¾";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F3FE').addEventListener('click', function(e) {code="ğŸ¾";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F3FF').addEventListener('click', function(e) {code="ğŸ¿";document.querySelector('#ID_mode01').innerHTML =code}, false);

    document.querySelector('#ID_1F332').addEventListener('click', function(e) {code="ğŸŒ²";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F333').addEventListener('click', function(e) {code="ğŸŒ³";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F333').addEventListener('click', function(e) {code="ğŸŒ³";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1FABE').addEventListener('click', function(e) {code="ğŸª¾";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1FAB5').addEventListener('click', function(e) {code="ğŸªµ";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F335').addEventListener('click', function(e) {code="ğŸŒµ";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID__26F0').addEventListener('click', function(e) {code="â›°";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F3D4').addEventListener('click', function(e) {code="ğŸ”";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1FAA8').addEventListener('click', function(e) {code="ğŸª¨";document.querySelector('#ID_mode01').innerHTML =code}, false);
    document.querySelector('#ID_1F9F1').addEventListener('click', function(e) {code="ğŸ§±";document.querySelector('#ID_mode01').innerHTML =code}, false);


  }, true);

</script>
</head>
<body>
ãƒ¢ãƒ¼ãƒ‰ï¼š<span id="ID_mode00"></span><br>
é¸æŠæ–‡å­—ï¼š<span id="ID_mode01"></span><br>
<span id="ID_selection">
<br>
<input type ="button" value ="ã‚¯ãƒªãƒƒã‚¯">
<input type ="button" value ="çŸ©å½¢é¸æŠ">
<input type ="button" value ="ç½«ç·šè¡¨ç¤º"><br>
<input type ="button" value ="å…¨å¡—">
<input type ="button" value ="ãƒ¬ã‚¤ãƒ¤ãƒ¼">
<input type ="button" value ="å…ƒã«æˆ»ã™">
</span>

<span id="ID_span01">
<div class="button-group">
  <input type ="button" value ="ğŸŸ¥" id="ID_1F7E5">
  <input type ="button" value ="ğŸŸ§" id="ID_1F7E7">
  <input type ="button" value ="ğŸŸ¨" id="ID_1F7E8">
  <input type ="button" value ="ğŸŸ©" id="ID_1F7E9">
  <input type ="button" value ="ğŸŸ¦" id="ID_1F7E6">
  <input type ="button" value ="ğŸŸª" id="ID_1F7EA">
  <input type ="button" value ="ğŸŸ«" id="ID_1F7EB">
  <input type ="button" value ="â¬›" id="ID__2B1B">
  <input type ="button" value ="â¬œ" id="ID__2B1C">
  <input type ="button" value ="â–‘" id="">
  <input type ="button" value ="â–’" id="">
  <input type ="button" value ="â–“" id="">
</div>
<div class="button-group">
  <input type ="button" value ="ğŸ»" id="ID_1F3FB">
  <input type ="button" value ="ğŸ¼" id="ID_1F3FC">
  <input type ="button" value ="ğŸ¾" id="ID_1F3FD">
  <input type ="button" value ="ğŸ¾" id="ID_1F3FE">
  <input type ="button" value ="ğŸ¿" id="ID_1F3FF">
  
  <input type ="button" value ="ğŸ”´" id="">
  <input type ="button" value ="ğŸŸ " id="">
  <input type ="button" value ="ğŸŸ¡" id="">
  <input type ="button" value ="ğŸŸ¢" id="">
</div>
<div class="button-group">
  <input type ="button" value ="ğŸŒ²" id="ID_1F332">
  <input type ="button" value ="ğŸŒ³" id="ID_1F333">
  <input type ="button" value ="ğŸª¾" id="ID_1FABE">
  <input type ="button" value ="ğŸªµ" id="ID_1FAB5">
  <input type ="button" value ="ğŸŒµ" id="ID_1F335">&nbsp;
  <input type ="button" value ="â›°" id="ID__26F0">
  <input type ="button" value ="ğŸ”" id="ID_1F3D4">
  <input type ="button" value ="ğŸª¨" id="ID_1FAA8">
  <input type ="button" value ="ğŸ§±" id="ID_1F9F1">
</div>
<input type ="button" value ="ğŸº" id=""><input type ="button" value ="ğŸ–">
<input type ="button" value ="ğŸ’£" id="">
<input type ="button" value ="ğŸ¢" id=""><br>
<input type ="button" value ="â­±" id=""><input type ="button" value ="â­°"><input type ="button" value ="â­²"><input type ="button" value ="â­³">
<input type ="button" value ="â¤’"><input type ="button" value ="â¤“">
<input type ="button" value ="â"><input type ="button" value ="â…"><input type ="button" value ="â†"><input type ="button" value ="â–"><br>
<input type ="button" value ="â‡¦"><input type ="button" value ="â‡§"><input type ="button" value ="â‡¨"><input type ="button" value ="â‡©"><input type ="button" value ="â‡³"><input type ="button" value ="â¬€"><input type ="button" value ="â¬"><input type ="button" value ="â¬‚"><input type ="button" value ="â¬ƒ"><input type ="button" value ="â¬„"><br>
<input type ="button" value ="â¬…"><input type ="button" value ="â¬†"><input type ="button" value ="â¬‡"><input type ="button" value ="â®•"><input type ="button" value ="â¬ˆ"><input type ="button" value ="â¬‰"><input type ="button" value ="â¬Š"><input type ="button" value ="â¬‹"><input type ="button" value ="â¬Œ"><input type ="button" value ="â¬">
</span>

<canvas id="ID_canvas01" width="500" height="400">
  canvasè¦ç´ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
</canvas>
<body>
</html>